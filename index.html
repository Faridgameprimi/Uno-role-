<!DOCTYPE html><html lang="ms">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>UNO Role — Dark Purple Edition (By Iman Akid)</title>
  <style>
    :root{
      --bg:#0b0014; --panel:#1a002b; --muted:#bfb2e6; --accent1:#7c3aed; --accent2:#9b5cf6; --glass:rgba(255,255,255,0.03); --success:#22c55e;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;background:linear-gradient(180deg,#070012 0%,#0b0014 100%);color:#efe7ff}
    header{background:linear-gradient(90deg,var(--accent1),var(--accent2));padding:18px;text-align:center}
    header h1{margin:0;font-size:20px}
    header p{margin:6px 0 0;color:rgba(255,255,255,0.9);font-size:13px}nav{display:flex;gap:8px;justify-content:center;padding:12px;background:transparent}
nav button{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);padding:8px 12px;border-radius:10px;cursor:pointer}
nav button.primary{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#0b0014;border:none}

.wrap{max-width:1100px;margin:18px auto;padding:0 14px}
.page{display:none}
.page.active{display:block}

.lobby-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
@media(max-width:980px){.lobby-grid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:600px){.lobby-grid{grid-template-columns:1fr}}

.card{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 6px 30px rgba(10,2,20,0.6)}
.card h3{margin:0 0 8px;color:var(--accent2)}
.muted{color:var(--muted);font-size:14px}

/* role list */
.role-list{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:12px}
@media(max-width:780px){.role-list{grid-template-columns:1fr}}
.role-item{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
.role-item h4{margin:0 0 6px;color:#e6d9ff}
.small{font-size:13px;color:var(--muted)}
.detail-btn{margin-top:8px;padding:8px 10px;border-radius:8px;border:none;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#0b0014;cursor:pointer}

/* pusingan grid (reused cards) */
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:12px}
@media(max-width:980px){.grid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:600px){.grid{grid-template-columns:1fr}}

.bignum{font-size:28px;font-weight:800}
.bar{height:8px;background:rgba(255,255,255,0.04);border-radius:6px;overflow:hidden}
.bar > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent1),var(--accent2));width:0%;transition:width .35s ease}

.log{margin-top:14px;background:rgba(0,0,0,0.18);padding:12px;border-radius:10px;height:200px;overflow:auto;border:1px solid rgba(255,255,255,0.02)}
.log .entry{font-size:13px;margin-bottom:6px}

/* custom pusingan */
.custom-controls{display:flex;gap:8px;align-items:center;margin-top:10px;flex-wrap:wrap}
select, input[type=number]{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
.controls button{padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
.btn-outline{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}

/* modal */
.modal{display:none;position:fixed;inset:0;background:linear-gradient(rgba(2,0,10,0.6),rgba(2,0,10,0.6));align-items:center;justify-content:center;padding:20px}
.modal.show{display:flex}
.modal-box{background:linear-gradient(180deg,#190026,#24003a);padding:18px;border-radius:12px;max-width:720px;width:100%;border:1px solid rgba(255,255,255,0.03)}

footer{margin-top:18px;text-align:center;color:var(--muted);padding:12px}

.notif{position:fixed;right:18px;bottom:18px;background:linear-gradient(90deg,var(--success),#16a34a);color:#042018;padding:10px 12px;border-radius:10px;box-shadow:0 8px 30px rgba(2,6,23,0.6);display:flex;gap:10px;align-items:center}
.hidden{display:none}

  </style>
</head>
<body>
  <header>
    <h1>UNO Role</h1>
    <p>By Iman Akid — Dark Purple Edition</p>
  </header>  <nav>
    <button class="primary" data-nav="lobby">Lobby</button>
    <button data-nav="roles">List Role</button>
    <button data-nav="tutorial">Tutorial</button>
    <button data-nav="pusingan">Pusingan Role</button>
    <button data-nav="custom">Pusingan Custom</button>
  </nav>  <div class="wrap">
    <!-- LOBBY -->
    <section id="lobby" class="page active">
      <div class="lobby-grid">
        <div class="card">
          <h3>Mulakan Game</h3>
          <p class="muted">Buka pengurus pusingan untuk mula main atau lihat senarai role dan tutorial.</p>
          <div style="margin-top:12px"><button class="detail-btn" data-nav="pusingan">Mula Pusingan Role</button></div>
        </div><div class="card">
      <h3>Senarai Role</h3>
      <p class="muted">Lihat peranan, skill, fungsi dan cara main bagi setiap role.</p>
      <div style="margin-top:12px"><button class="detail-btn" data-nav="roles">Buka Senarai Role</button></div>
    </div>

    <div class="card">
      <h3>Tutorial</h3>
      <p class="muted">Panduan ringkas untuk gunakan sistem dan tips strategi.</p>
      <div style="margin-top:12px"><button class="detail-btn" data-nav="tutorial">Baca Tutorial</button></div>
    </div>
  </div>
</section>

<!-- ROLES -->
<section id="roles" class="page">
  <div class="card">
    <h3>Senarai Role</h3>
    <p class="muted">Klik "Butiran" untuk lihat Fungsi Role dan Cara Main.</p>
    <div class="role-list" id="roleList"></div>
  </div>
</section>

<!-- TUTORIAL -->
<section id="tutorial" class="page">
  <div class="card">
    <h3>Tutorial & Panduan</h3>
    <div class="muted" style="margin-top:8px">
      <ol>
        <li>Buka <strong>Pusingan Role</strong> untuk mengurus pusingan semua role serentak.</li>
        <li>Buka <strong>Pusingan Custom</strong> untuk urus satu role pada satu masa.</li>
        <li>Tekan <strong>+1 Pusingan</strong> selepas setiap pusingan pemain selesai.</li>
        <li>Apabila cukup pusingan, butang <strong>Gunakan Skill</strong> akan aktif — tekan untuk gunakan.</li>
        <li>Eksport / import state untuk simpan sesi permainan.</li>
      </ol>
    </div>
  </div>
</section>

<!-- PUSINGAN ROLE (grid, semua role) -->
<section id="pusingan" class="page">
  <div class="card">
    <h3>Pengurus Pusingan (Semua Role)</h3>
    <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
      <button class="detail-btn" id="globalAdd">+1 Global</button>
      <button class="detail-btn" id="resetAll">Reset Semua</button>
      <button class="detail-btn" id="exportAll">Export</button>
    </div>

    <div class="grid" id="rolesGrid"></div>
    <div class="log" id="logAll"></div>
  </div>
</section>

<!-- PUSINGAN CUSTOM (NEW) -->
<section id="custom" class="page">
  <div class="card">
    <h3>Pusingan Custom — Pilih 1 Role</h3>
    <p class="muted">Pilih satu role, tambah pusingan, dan gunakan skill bila cukup.</p>

    <div style="margin-top:10px;display:flex;gap:10px;align-items:center;flex-wrap:wrap">
      <select id="customRole" style="min-width:220px;padding:8px;border-radius:8px;background:transparent;color:inherit;border:1px solid rgba(255,255,255,0.04)"></select>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="detail-btn" id="cAdd">+1 Pusingan</button>
        <button class="btn-outline" id="cReset">Reset</button>
        <button class="detail-btn" id="cUse">Gunakan Skill</button>
      </div>
    </div>

    <div style="margin-top:12px">
      <div class="bignum" id="cCount">0</div>
      <div class="bar" style="margin-top:8px"><i id="cBar"></i></div>
      <div class="muted" style="margin-top:8px">Status: <span id="cStatus">Tidak Aktif</span></div>
    </div>

    <div class="log" id="logCustom"></div>
  </div>
</section>

  </div>  <!-- modal untuk butiran role -->  <div id="modal" class="modal" onclick="if(event.target.id==='modal') closeModal()">
    <div class="modal-box" id="modalBox"></div>
  </div>  <div id="notif" class="notif hidden"><div id="notifText">Skill Ready!</div></div>  <footer>© 2025 UNO Role — By Iman Akid</footer>  <script>
    // Role data (full descriptions per user)
    const ROLES = [
      {id:'Hacker', name:'Hacker', skill:'Bebas Letak Card Apa2', p:4, fungsi:'Setiap kali 4 pusingan Kamu dibenarkan Meletak Card apa2 Walaupun Card itu berlainan', cara:'Jika kamu tidak mempunyai card yang player lain letak, kamu bebas meletak card apa yang kamu nak selepas 4 pusingan, Card Function Tidak berfungsi Ketika Di letak'},
      {id:'Shield', name:'Shield', skill:'Anti Card Gimmick', p:2, fungsi:'Setiap kali 2 pusingan Kamu akan kebal terhadap card gimmik, Contohnya +2, +4, +6, +10, Dan lain, Jika ada yang menggunakan card gimmik ke kamu, Gimmik tersebut akan diberi kembali ke Player yang meletak card tersebut', cara:'Jika kamu tidak ingin menambah card tambah, kamu boleh menggunakan skill ini untuk mengcounter balik musuh'},
      {id:'Nezam', name:'Nezam', skill:'Bakar Card Mengikut warna', p:3, fungsi:'Setiap kali 3 pusingan kamu dapat membuang Semua Card Warna Yang sama, tidak untuk card yang nombor sama, Hanya Boleh membuat satu warna dalam 3 pusingan', cara:'Buat cadangan Untuk Menyimpan Card Yang Kamu dapat dari musuh, Main role ini harus banyak bersabar kerana diakhir2 kamu dapat membakar semua berwarna sama, Kamu harus asingkan card yang dapat dari card tambah atau card yang dapat dari desk'},
      {id:'Mayor', name:'Mayor', skill:'Simpan dan buang Card', p:3, fungsi:'Setiap kali 3 pusingan Kamu dapat membuang Semua card yang kamu simpan sebelum ini yang kamu dapat dari card gimmik tak termasuk yang kamu ambik di Desk card', cara:'Role ini perlu kesabaran yang tinggi, kamu perlu membuat rancangan untuk menang menggunakan role ini, Kamu perlu belajar menyimpan card yang didapatkan dari musuh dan asingkan yang dapat card dari desk, akhirnya habiskan semua card kamu yang tidak dapat dari musuh lalu buang semua card yang kamu dapat dari musuh supaya kamu boleh menang'},
      {id:'Ghoust', name:'Ghoust', skill:'Mengontrol Card gimmick mengikut suka hati setelah Menang', p:5, fungsi:'Kalau kamu sudah menang setiap kali 5 pusingan kamu akan dapat mengontrol card gimmik, contohnya Jika orang letak card gimmik +2, kamu Boleh mengubahnya jadi wild card atau card gimmick lainnya', cara:'Role ini Lebih ke troll role, sebab kamu Harus menang baru dapat menggunakan role ini, role ini memang cukup op, Untuk role ini main je macam biasa'},
      {id:'Spammer', name:'Spammer', skill:'Spam Card Mengikut warna yang sama', p:1, fungsi:'Setiap kali 1 pusingan kamu dapat meletakkan semua card kamu mengikut warna yang sama', cara:'Role nih memang sesuai untuk Orang yang nak menang cepat, Caranya Setiap pusingan buang card berwarna yang paling banyak kamu ada, tapi ingat card gimmik tak berfungsi'},
      {id:'Rewind', name:'Rewind', skill:'pusingkan waktu kesebelumnya', p:2, fungsi:'Setiap kali 2 pusingan kamu dapat pusingkan waktu kepada sebelumnya, contohnya Setiap card yang kamu letak di satu pusingan itu haruslah di kembalikan seperti semula di awal pusingan, Maksud awal pusingan tu setiap habis pusingan orang tersebut dia harus memberi kembali seperti yang awal2 pusingan', cara:'Role ini dipakai waktu kamu melakukan kesalahan atau tersalah letak card, sebab role ini akan membalikkan waktu seperti awal pusingan, Memang sedikit susah untuk memahami role ini'},
      {id:'Andiko', name:'Andiko', skill:'Copy Role', p:null, fungsi:'Kamu dapat copy role card player lain dan main mengikut Skill role meraka', cara:'Kamu pilih role yang menurut kamu Boleh menang, sebab role ini hanya copy Role dari player lain'},
      {id:'Whitejack', name:'Whitejack', skill:'Teka Card Dan Buang Card', p:2, fungsi:'Setiap kali 2 pusingan kamu dapat Teka card player lain jika betul kamu boleh membuang 4 card kamu jika salah kamu harus mengambil 4 card di desk', cara:'Role nih kena banyak menghafal card player, sebab role ini berguna waktu tukar card dengan player kerana kamu tahu card apa yang musuh ada, Role nih kena hafal card'},
      {id:'Blackjack', name:'Blackjack', skill:'Teka card dan tambah card', p:2, fungsi:'Setiap kali 2 pusingan kamu dapat Teka card player lain jika betul Suruh player tersebut tambah 4 card yang ada di desk, jika salah kamu yang harus tambah 4 card yang ada di desk', cara:'Role nih pun sama dengan whitejack kena banyak menghafal card player, sebab role ini berguna waktu tukar card dengan player kerana kamu tahu card apa yang musuh ada, Role nih kena hafal card, Bezanya role ini menambahkan card musuh bukan mengurangkan kamu'},
      {id:'Purplejack', name:'Purplejack', skill:'Teka Card Dan beri card', p:3, fungsi:'Setiap kali 3 pusingan kamu dapat Teka card player lain jika betul kamu dapat memberi 4 card kamu kepada player lain, jika salah kamu yang harus mengambil 4 card kepada player lain', cara:'Role nih gabungan dari whitejack dan blackjack sama je kena banyak menghafal card player, sebab role ini berguna waktu tukar card dengan player kerana kamu tahu card apa yang musuh ada, Role nih kena hafal card'},
      {id:'Bounty', name:'Bounty', skill:'Lock Player Dan tambahkan Card', p:2, fungsi:'Setiap kali 2 pusingan Kamu dapat lock 1 player sehingga masuk pusingan seterusnya, Skillnya aktif apa bila Player atau kamu menggunakan Card gimmick player yang dilock terkena card tersebut', cara:'Role ini bagus buat kamu Yang Dalam kondisi uno card, Kerana dapat mengelak dari tambah card, Kamu kena Lock player yang ada card sikit, sebab role ini sangat berguna'},
      {id:'Time assasin', name:'Time assasin', skill:'Ulang card dari awal kecuali kamu', p:10, fungsi:'Setiap kali 10 pusingan kamu dapat mereset semua card player kecuali kamu, maksudnya Semua card reset dan diberi seperti awal mula main kecuali kamu', cara:'Main role nih Kena banyak bersabar, Reset card waktu Card Dorang dah start sikit, Kalau card dorang banyak, jangan reset sebab itu akan merugikan'},
      {id:'Phamtom', name:'Phamtom', skill:'Ada 10Card Menang', p:null, fungsi:'Jika Kamu ada 10 card di tangan Kamu boleh Menang, jika lebih atau kurang, Kamu Tidak akan menang', cara:'Main role nih kena pandai, jangan sampai musuh Bagi card tambah, sebab tu terlalu susah untuk menang, Ingat Jangan lebih jangan kurang, Main role nih jawap bawak ke akhir game sebab dia akan jadi susah, Start game je, cari card banyak2 sampai 10'},
      {id:'Joker', name:'Joker', skill:'1 Card Swap', p:null, fungsi:'Jika Ada player lain mempunyai 1 card, Player tersebut harus swap card Ke kamu', cara:'Role nih sedikit enoying, dan kamu boleh cepat menang main role ini, tapi ingat musuh tetap boleh bagi card tambah'}
    ];

    // STORAGE
    const STORAGE_ALL = 'uno_role_state_all_v2';
    const STORAGE_CUSTOM = 'uno_role_state_custom_v1';

    // state
    let stateAll = {};
    let stateCustom = { role: null, round: 0 };

    // elements
    const pages = document.querySelectorAll('.page');
    const navButtons = document.querySelectorAll('[data-nav]');
    const roleListEl = document.getElementById('roleList');
    const rolesGrid = document.getElementById('rolesGrid');
    const logAll = document.getElementById('logAll');

    // custom elems
    const customRoleSel = document.getElementById('customRole');
    const cCount = document.getElementById('cCount');
    const cBar = document.getElementById('cBar');
    const cStatus = document.getElementById('cStatus');
    const logCustom = document.getElementById('logCustom');

    // modal and notif
    const modal = document.getElementById('modal');
    const modalBox = document.getElementById('modalBox');
    const notif = document.getElementById('notif');
    const notifText = document.getElementById('notifText');

    // NAV
    navButtons.forEach(b=>b.addEventListener('click', ()=>{ const id=b.getAttribute('data-nav'); showPage(id); }));
    document.querySelectorAll('[data-nav]').forEach(btn=>btn.addEventListener('click', ()=>{}));
    function showPage(id){ pages.forEach(p=>p.classList.remove('active')); const el = document.getElementById(id); if(el) el.classList.add('active'); window.scrollTo({top:0,behavior:'smooth'}); }

    // init load
    function loadState(){
      // all roles state
      const raw = localStorage.getItem(STORAGE_ALL);
      if(raw){ try{ stateAll = JSON.parse(raw); }catch(e){ stateAll = {}; }}
      ROLES.forEach(r=>{ if(!stateAll[r.id]) stateAll[r.id] = {round:0,used:false}; });
      // custom
      const raw2 = localStorage.getItem(STORAGE_CUSTOM);
      if(raw2){ try{ stateCustom = JSON.parse(raw2); }catch(e){ stateCustom = {role:null,round:0}; }}
      saveAll(); saveCustom();
    }
    function saveAll(){ localStorage.setItem(STORAGE_ALL, JSON.stringify(stateAll)); }
    function saveCustom(){ localStorage.setItem(STORAGE_CUSTOM, JSON.stringify(stateCustom)); }

    // render role list
    function renderRoleList(){ roleListEl.innerHTML=''; ROLES.forEach(r=>{
      const d = document.createElement('div'); d.className='role-item';
      d.innerHTML = `<h4>${r.name} <span class="small">${r.p===null? 'No' : r.p+'x'}</span></h4>
        <div class="small"><strong>Skill:</strong> ${r.skill}</div>
        <div class="small" style="margin-top:6px"><strong>Fungsi Role:</strong> ${r.fungsi}</div>
        <div class="small" style="margin-top:6px"><strong>Cara Main:</strong> ${r.cara}</div>
        <div style="margin-top:8px"><button class="detail-btn" onclick="openModal('${r.id}')">Butiran</button></div>`;
      roleListEl.appendChild(d);
    }); }

    // modal open
    function openModal(id){ const r = ROLES.find(x=>x.id===id); if(!r) return; modalBox.innerHTML = `<h3>${r.name}</h3><p class="small"><strong>Skill:</strong> ${r.skill}</p><p class="small"><strong>Pusingan:</strong> ${r.p===null? 'No' : r.p+'x'}</p><hr><p class="small"><strong>Fungsi Role:</strong> ${r.fungsi}</p><p class="small"><strong>Cara Main:</strong> ${r.cara}</p><div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end"><button class="detail-btn" onclick="closeModal()">Tutup</button></div>`; modal.classList.add('show'); }
    function closeModal(){ modal.classList.remove('show'); }

    // render pusingan grid (all)
    function createCardAll(r){
      const card = document.createElement('div'); card.className='card';
      const title = document.createElement('h3'); title.textContent = r.name + ' — ' + (r.p===null? 'No' : r.p+'x');
      const skill = document.createElement('div'); skill.className='muted'; skill.textContent = r.skill;
      const count = document.createElement('div'); count.className='bignum'; count.id = 'all_'+r.id;
      const bar = document.createElement('div'); bar.className='bar'; bar.innerHTML = `<i id="bar_all_${r.id}"></i>`;
      const actions = document.createElement('div'); actions.className='action-row';
      const addBtn = document.createElement('button'); addBtn.className='detail-btn'; addBtn.textContent = '+1 Pusingan';
      const useBtn = document.createElement('button'); useBtn.className='btn-outline'; useBtn.textContent = 'Gunakan Skill';
      addBtn.addEventListener('click', ()=>{ stateAll[r.id].round +=1; stateAll[r.id].used=false; saveAll(); updateAllCard(r); logAllMsg(`+1 pusingan untuk ${r.name} → R${stateAll[r.id].round}`); checkNotifyAll(r); });
      useBtn.addEventListener('click', ()=>{ if(!isSkillReady(r, stateAll[r.id].round)) return alert('Skill belum ready'); logAllMsg(`SKILL DIGUNAKAN: ${r.name} (R${stateAll[r.id].round})`); stateAll[r.id].round=0; stateAll[r.id].used=true; saveAll(); updateAllCard(r); showNotification(`${r.name} gunakan skill!`); });
      actions.appendChild(addBtn); actions.appendChild(useBtn);
      card.appendChild(title); card.appendChild(skill); card.appendChild(count); card.appendChild(bar); card.appendChild(actions);
      return {card, count, bar, addBtn, useBtn};
    }

    function renderAllGrid(){ rolesGrid.innerHTML=''; ROLES.forEach(r=>{ const {card} = createCardAll(r); rolesGrid.appendChild(card); }); ROLES.forEach(updateAllCard); }

    function updateAllCard(r){ const elCount = document.getElementById('all_'+r.id); const elBar = document.getElementById('bar_all_'+r.id); if(!elCount || !elBar) return; const s = stateAll[r.id]; elCount.textContent = s.round; if(r.p===null){ elBar.style.width='100%'; } else { const pct = Math.min(100, Math.round((s.round % r.p)/r.p*100)); elBar.style.width = pct + '%'; } // style change
      if(isSkillReady(r, s.round)){ elCount.style.color = 'var(--success)'; } else elCount.style.color = '';
    }

    function isSkillReady(r, round){ if(r.p===null) return true; if(round===0) return false; return (round % r.p === 0); }

    function logAllMsg(msg){ const d = new Date(); const t = d.toLocaleTimeString(); const div = document.createElement('div'); div.className='entry'; div.textContent = `[${t}] ${msg}`; logAll.prepend(div); }

    function checkNotifyAll(r){ if(isSkillReady(r, stateAll[r.id].round)){ showNotification(`${r.name} SKILL READY!`); logAllMsg(`${r.name} SKILL READY pada R${stateAll[r.id].round}`); } }

    // CUSTOM PAGE FUNCTIONS
    function populateCustomSelect(){ customRoleSel.innerHTML=''; const opt = document.createElement('option'); opt.value=''; opt.textContent='-- Pilih Role --'; customRoleSel.appendChild(opt); ROLES.forEach(r=>{ const o = document.createElement('option'); o.value = r.id; o.textContent = r.name + (r.p===null? ' (No)': ' ('+r.p+'x)'); customRoleSel.appendChild(o); }); if(stateCustom.role) customRoleSel.value = stateCustom.role; updateCustomUI(); }

    function updateCustomUI(){ const sel = customRoleSel.value; if(!sel){ cCount.textContent = 0; cBar.style.width = '0%'; cStatus.textContent = 'Pilih role dahulu'; return; } const r = ROLES.find(x=>x.id===sel); const round = stateCustom.role===sel? stateCustom.round : stateAll[sel]?.round || 0; cCount.textContent = round; // progress
      if(r.p===null){ cBar.style.width = '100%'; cStatus.textContent = 'Boleh guna (No cooldown)'; } else { const pct = Math.min(100, Math.round((round % r.p)/r.p*100)); cBar.style.width = pct + '%'; if(isSkillReady(r, round)){ cStatus.textContent = 'Skill Ready!'; } else { const left = r.p - (round % r.p || 0); cStatus.textContent = `Aktif dalam ${left} pusingan`; } }
    }

    document.getElementById('cAdd').addEventListener('click', ()=>{
      const sel = customRoleSel.value; if(!sel) return alert('Pilih role dahulu'); if(stateCustom.role && stateCustom.role!==sel){ // transfer previous custom state to global
        stateAll[stateCustom.role].round = stateCustom.round; stateCustom.round = stateAll[sel].round || 0; stateCustom.role = sel;
      } else { stateCustom.role = sel; }
      stateCustom.round = (stateCustom.round||0) + 1; saveCustom(); updateCustomUI(); logCustomMsg(`+1 pusingan untuk ${sel} → R${stateCustom.round}`); // keep global in sync optional
      checkNotifyCustom();
    });

    document.getElementById('cReset').addEventListener('click', ()=>{
      if(!confirm('Reset pusingan role custom ke 0?')) return; stateCustom.round = 0; saveCustom(); updateCustomUI(); logCustomMsg('Pusingan custom direset');
    });

    document.getElementById('cUse').addEventListener('click', ()=>{
      const sel = customRoleSel.value; if(!sel) return alert('Pilih role dahulu'); const r = ROLES.find(x=>x.id===sel); const round = stateCustom.round || 0; if(!isSkillReady(r, round)) return alert('Skill belum ready'); logCustomMsg(`SKILL DIGUNAKAN: ${r.name} (R${round})`); stateCustom.round = 0; saveCustom(); updateCustomUI(); showNotification(`${r.name} gunakan skill!`);
    });

    customRoleSel.addEventListener('change', ()=>{ const sel = customRoleSel.value; if(sel){ // load from global if exists
      stateCustom.role = sel; stateCustom.round = stateAll[sel]?.round || stateCustom.round || 0; saveCustom(); } updateCustomUI(); });

    function logCustomMsg(msg){ const d = new Date(); const t = d.toLocaleTimeString(); const div = document.createElement('div'); div.className='entry'; div.textContent = `[${t}] ${msg}`; logCustom.prepend(div); }

    function checkNotifyCustom(){ const sel = customRoleSel.value; if(!sel) return; const r = ROLES.find(x=>x.id===sel); if(isSkillReady(r, stateCustom.round)){ showNotification(`${r.name} SKILL READY!`); logCustomMsg(`${r.name} SKILL READY pada R${stateCustom.round}`); } }

    // notification
    let notifTimer = null;
    function showNotification(txt){ notifText.textContent = txt; notif.classList.remove('hidden'); clearTimeout(notifTimer); notifTimer = setTimeout(()=>{ notif.classList.add('hidden'); },3600); }

    // global handlers
    document.getElementById('globalAdd').addEventListener('click', ()=>{ ROLES.forEach(r=>{ stateAll[r.id].round +=1; stateAll[r.id].used=false; }); saveAll(); ROLES.forEach(updateAllCard); logAllMsg('Global +1 pusingan (semua role)'); ROLES.forEach(checkNotifyAll); });
    document.getElementById('resetAll').addEventListener('click', ()=>{ if(!confirm('Reset semua pusingan ke 0?')) return; ROLES.forEach(r=>{ stateAll[r.id].round = 0; stateAll[r.id].used=false; }); saveAll(); ROLES.forEach(updateAllCard); logAllMsg('Semua pusingan direset ke 0'); });
    document.getElementById('exportAll').addEventListener('click', ()=>{ const data = {all:stateAll, custom:stateCustom}; const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='uno-role-session.json'; a.click(); URL.revokeObjectURL(url); });

    // init
    loadState(); renderRoleList(); renderAllGrid(); populateCustomSelect(); // attach event to nav-style buttons inside cards
    document.querySelectorAll('[data-nav]').forEach(b=>b.addEventListener('click', ()=>{ showPage(b.getAttribute('data-nav')); }));
    // keep saving periodically
    setInterval(()=>{ saveAll(); saveCustom(); },3000);

    // keyboard shortcut G -> global +1
    window.addEventListener('keydown', (e)=>{ if(e.key.toLowerCase()==='g'){ document.getElementById('globalAdd').click(); } });

  </script></body>
</html>